# OAuth Server系统设计

## 1. 功能介绍

OAuth Server 提供基于OAuth 2.0 的认证服务

## 2. 时序图

![](/assets/oauth-server-design.png)

## 3. 服务划分

```
oauthweb //前端web工程，用于提供授权许可和访问令牌等外部接口

oauthz //核心服务，用于提供数据服务，以及应用注册，令牌验证等内部服务

oauthmgr //管理控制台，用于后台管理监控等
```

> `内部接口`是指提供给开发者门户和api网关等云平台内部组件使用的接口  
> `外部接口`是指提供给第三方应用的接口

## 4. 部署架构

![](/assets/oauth-server-deploy-struct.png)

## 5. 非功能性设计

### 5.1 访问安全

提供给第三方应用的对外接口，例如授权许可、获取访问令牌等接口均以`HTTPS`协议提供

### 5.2 重定向URL验证

严格校验应用注册的重定向URL和接口调用中的重定向URL，当二者相同时才颁发授权码或访问令牌

### 5.3 授权码和访问令牌的随机性

随机生成授权码和访问令牌，防止凭据猜测攻击

### 5.4 CSRF攻击

为防止`csrf`攻击，强烈建议第三方应用获取授权许可时校验`state`参数

### 5.5 接口调用频度限制

为防止恶意请求，限制同一客户端\(`client_id`\)调用接口的频度\(最小时间间隔，以及单位时间内的总调用次数\)

### 5.6 异常现象处理

如有发现授权码或者访问令牌泄露，例如不同客户端使用相同访问令牌，则使之立刻过期

### 5.7 异常现象可追溯

记录关键日志到数据库，以此追溯异常现象

